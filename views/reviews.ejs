
<%- include('partials/header') %>
<div class="py-24 max-w-7xl mx-auto px-4">
    <div class="grid md:grid-cols-12 gap-12">
        <!-- Sidebar Form -->
        <div class="md:col-span-4 h-fit sticky top-24">
            <div class="bg-white p-8 rounded-[40px] shadow-xl border border-stone-100 relative overflow-hidden">
                <div class="absolute top-0 right-0 w-32 h-32 bg-rose-50 rounded-full blur-3xl -z-0"></div>
                <h2 class="text-3xl font-serif italic mb-6 relative z-10 text-stone-900">Ваш опыт</h2>
                
                <% if(user) { %>
                <form action="/reviews/add" method="POST" class="space-y-4 relative z-10" x-data="{ rating: 5, hasPhoto: false }">
                    <!-- Rating -->
                    <div class="flex gap-2 text-2xl text-stone-200 cursor-pointer mb-4">
                        <template x-for="i in 5">
                            <i class="fas fa-star transition hover:scale-110 hover:text-yellow-400" :class="i <= rating ? 'text-yellow-400' : ''" @click="rating = i"></i>
                        </template>
                        <input type="hidden" name="rating" :value="rating">
                    </div>
                    
                    <textarea name="text" rows="4" placeholder="Расскажите, как прошел прием..." class="w-full bg-stone-50 border-0 rounded-2xl p-4 focus:ring-2 focus:ring-rose-500 resize-none outline-none transition text-sm"></textarea>
                    
                    <!-- Fake Photo Upload -->
                    <div class="relative">
                        <button type="button" @click="hasPhoto = !hasPhoto" class="flex items-center gap-2 text-xs font-bold uppercase tracking-widest text-stone-500 hover:text-stone-900 transition">
                            <i class="fas fa-camera"></i> <span x-text="hasPhoto ? 'Убрать фото' : 'Добавить фото'"></span>
                        </button>
                        <input x-show="hasPhoto" x-transition type="text" name="photoUrl" placeholder="Ссылка на фото (URL)" class="w-full mt-2 bg-stone-50 border-0 rounded-xl px-4 py-2 text-xs outline-none">
                    </div>

                    <button class="w-full bg-stone-900 text-white py-4 rounded-xl font-bold uppercase tracking-widest hover:bg-rose-500 transition shadow-lg text-xs">Опубликовать</button>
                </form>
                <% } else { %>
                    <div class="text-center py-8 relative z-10">
                         <div class="text-4xl text-stone-200 mb-4"><i class="fas fa-lock"></i></div>
                         <p class="text-stone-500 mb-4 text-sm">Войдите, чтобы поделиться мнением.</p>
                         <a href="/auth/login" class="text-rose-500 font-bold border-b border-rose-500 pb-1 hover:text-rose-600 transition">Войти в аккаунт</a>
                    </div>
                <% } %>
            </div>
        </div>

        <!-- Reviews Masonry -->
        <div class="md:col-span-8 space-y-8">
            <% if(reviews.length > 0) { %>
                <% reviews.forEach(r => { %>
                <div class="bg-white p-8 rounded-[32px] shadow-sm border border-stone-100 flex gap-6 reveal group hover:border-rose-200 transition">
                    <div class="flex-shrink-0">
                         <img src="<%= r.userAvatar || 'https://ui-avatars.com/api/?name='+r.userName %>" class="w-14 h-14 rounded-full object-cover shadow-sm">
                    </div>
                    <div class="flex-1">
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <h3 class="font-bold text-lg text-stone-900"><%= r.userName %></h3>
                                <div class="text-xs text-stone-400"><%= new Date(r.createdAt).toLocaleDateString() %></div>
                            </div>
                            <div class="flex text-yellow-400 text-xs">
                                <% for(let i=0; i<r.rating; i++) { %> <i class="fas fa-star"></i> <% } %>
                            </div>
                        </div>
                        <p class="text-stone-600 leading-relaxed mb-4"><%= r.text %></p>
                        <% if(r.photoUrl) { %>
                            <div class="h-64 rounded-2xl overflow-hidden shadow-sm mt-4 relative group/img">
                                <img src="<%= r.photoUrl %>" class="w-full h-full object-cover transform group-hover/img:scale-105 transition duration-700">
                            </div>
                        <% } %>
                    </div>
                </div>
                <% }) %>
            <% } else { %>
                <div class="text-center py-20 bg-stone-50 rounded-[40px]">
                    <p class="text-stone-400">Пока отзывов нет. Станьте первым!</p>
                </div>
            <% } %>
        </div>
    </div>
</div>
<%- include('partials/footer') %>
